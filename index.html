<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ã‚¬ã‚½ãƒªãƒ³ä»£è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>

<style>
:root{
    --main: #7b9cff;
    --main-dark: #4a6cf7;
    --bg: #f7f8fc;
    --bg-dark: #1e1f25;
    --text: #2a2a2a;
    --text-dark: #e8e8e8;
    --card-bg: #ffffff;
    --card-bg-dark: #2d2f36;
    --radius: 14px;
    --shadow: 0 8px 28px rgba(0,0,0,0.12);
}
*{box-sizing:border-box}
body{
    font-family: 'Segoe UI', system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
    margin:0;
    padding:0;
    background: linear-gradient(180deg,#ffffff 0%,var(--bg) 100%);
    color:var(--text);
    transition:background .3s,color .3s;
}
body.dark{
    background: var(--bg-dark);
    color: var(--text-dark);
}
body.dark .container{
    background:var(--card-bg-dark);
}
body.dark .header{
    background:var(--main-dark);
    color:#fff;
}
body.dark input[type="number"],
body.dark input[type="text"]{
    background:#2b2d34;
    color:#fff;
    border-color:#555;
}
body.dark label{
    color:#dcdcdc;
}
body.dark .result{
    background:#39405a;
    color:#f0f0ff;
    border-left-color:#9cb3ff;
}
body.dark .historyItem{
    background:#383b46;
    border-left-color:#9cb3ff;
    color:#e8e8e8;
    box-shadow:none;
}
body.dark #historyBox{
    background:#2f323c;
}
body.dark .copy-btn.primary,
body.dark .copy-btn.secondary{
    color:#fff;
}
body.dark .theme-toggle{
    color:#fff;
    background: rgba(255,255,255,0.18);
}
body.dark label[for="roundTrip"],
body.dark .car-round-label { color:#f0f0f0 !important; }
body.dark .historyItem b { color:#cfcfff; }
body.dark .tab-btn{ background:#4a4d5c; color:#c9c9c9; }
body.dark .tab-btn.active{ background:var(--main-dark); color:#fff; }
body.dark .car-item strong,
body.dark .car-input-labels{ color:#e0e0e0; }
body.dark .car-round-group label{ color:#f0f0f0; }
body.dark .car-label{ color:#f0f0f0; }

.header{
    background:var(--main);
    padding:22px;
    text-align:center;
    color:#fff;
    font-size:22px;
    font-weight:700;
    position:relative;
    box-shadow:var(--shadow);
}
.theme-toggle{
    position:absolute;
    right:18px;
    top:14px;
    background: rgba(255,255,255,0.18);
    padding:8px 12px;
    border-radius:999px;
    cursor:pointer;
    color:#fff;
    font-size:14px;
    border:none;
}

.container{
    max-width:560px;
    margin:34px auto;
    padding:26px;
    background:var(--card-bg);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
}

label{ display:block; margin-top:14px; font-size:13px; font-weight:700; color:#525252; }
.input-row{ display:flex; align-items:center; gap:10px; }
input[type="number"], input[type="text"]{ flex:1; width:100%; padding:12px; border-radius:12px; border:1px solid #dcdfea; background:#fff; font-size:15px; }
input[type="checkbox"]{ transform: scale(1.05); margin-left:6px; }
button.main-btn{ width:100%; margin-top:20px; padding:13px; background:var(--main); color:#fff; border:none; border-radius:40px; font-size:16px; cursor:pointer; }
button.sub-btn{ width:100%; margin-top:12px; padding:11px; background:#d4d7dd; color:#222; border:none; border-radius:12px; font-size:15px; cursor:pointer; }
.tab-btn{ flex:1; padding:10px; border:none; border-radius:10px; background:#e0e0e0; color:#333; font-weight:600; cursor:pointer; transition:background .2s,color .2s; }
.tab-btn.active{ background:var(--main); color:#fff; }

.car-list-container { padding-top:5px; }
.car-input-labels { display:flex; gap:6px; margin-bottom:5px; font-size:12px; font-weight:500; color:#555; align-items:center; padding-right:18px; }
.car-input-labels > div { flex:1; text-align:center; }
.car-input-labels > div:first-child { flex:0 0 100px; text-align:left; }
.car-item { margin-bottom:15px; padding:8px 0; border-bottom:1px solid #eee; }
#carList input[type="number"], #carList input[type="text"]{ padding:8px 6px; border-radius:8px; font-size:14px; text-align:center; }
#carList strong{ display:flex; justify-content:space-between; align-items:center; margin-top:14px; font-size:14px; color:#333; }
.car-row-inner{ display:flex; gap:6px; margin-top:4px; align-items:center; }
.car-round-group{ display:flex; align-items:center; gap:2px; white-space:nowrap; font-size:14px; color:#555; flex:0 0 auto; }
.car-round-group input[type="checkbox"]{ transform: scale(0.95); margin-left:0; }
.carName { flex:0 0 100px; text-align:left !important; padding:8px 12px !important; }

.result{ margin-top:18px; padding:16px 18px; background:#eef3ff; border-left:6px solid var(--main); border-radius:12px; color:#111; font-size:15px; line-height:1.6; transition:background .25s,color .25s; }

.copy-row{ display:flex; gap:10px; margin-top:12px; }
.copy-btn{ flex:1; padding:10px; border-radius:12px; border:none; cursor:pointer; font-size:14px; }
.copy-btn.primary{ background:var(--main); color:#fff; }
.copy-btn.secondary{ background:#9aa3ff; color:#fff; }

#historyBox{ margin-top:28px; padding:18px; background:#eef0ff; border-radius:12px; }
#historyList{ display:flex; flex-direction:column; gap:12px; margin-top:8px; }
.historyItem{ padding:12px 14px; border-radius:12px; background:#fff; border-left:6px solid var(--main); box-shadow:0 2px 8px rgba(0,0,0,0.06); transition: transform .18s, box-shadow .18s; cursor:pointer; color:#222; line-height:1.5; font-size:14px; }
.historyItem b{ display:block; font-size:13px; color:#444; margin-bottom:6px; }
.historyItem:hover{ transform: translateY(-3px); box-shadow:0 6px 14px rgba(0,0,0,0.12); }

@media (max-width:520px){
    .container{ margin:18px; padding:18px; }
    .theme-toggle{ right:12px; top:10px; padding:6px 10px; }
    .car-row-inner{ flex-wrap: wrap; }
    .car-round-group{ flex:1 1 100%; justify-content:flex-end; }
    .car-input-labels > div:first-child, .carName { flex:0 0 80px; }
}
</style>
</head>

<body>
<div class="header">
    ã‚¬ã‚½ãƒªãƒ³ä»£è¨ˆç®—ãƒ„ãƒ¼ãƒ«
    <button class="theme-toggle" id="themeToggle" aria-label="ãƒ†ãƒ¼ãƒåˆ‡æ›¿">ğŸŒ™</button>
</div>

<div class="container" role="main" aria-labelledby="mainTitle">
    <h2 id="mainTitle" style="margin:0 0 8px 0; font-size:1.1rem; color:var(--main);">è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>

    <div style="display:flex; gap:8px; margin-bottom:14px;">
        <button class="tab-btn active" data-mode="single">1å°</button>
        <button class="tab-btn" data-mode="multi">è¤‡æ•°å°</button>
    </div>

    <div id="singleCarForm">
        <label for="distance">èµ°è¡Œè·é›¢ï¼ˆkmï¼‰</label>
        <input id="distance" type="number" placeholder="ä¾‹ï¼š120">

        <label for="fuelEconomy">ç‡ƒè²»ï¼ˆkm/Lï¼‰</label>
        <input id="fuelEconomy" type="number" placeholder="ä¾‹ï¼š15">

        <label for="gasPrice">ã‚¬ã‚½ãƒªãƒ³ä¾¡æ ¼ï¼ˆå††/Lï¼‰</label>
        <input id="gasPrice" type="number" placeholder="ä¾‹ï¼š170">

        <label for="people">å‰²ã‚Šå‹˜äººæ•°ï¼ˆä»»æ„ï¼‰</label>
        <input id="people" type="number" placeholder="ä¾‹ï¼š3">

        <div style="display:flex; align-items:center; gap:8px; margin-top:12px;">
            <input id="roundTrip" type="checkbox" />
            <label for="roundTrip" style="margin:0; font-weight:600; color:#555;">å¾€å¾©ï¼ˆãƒã‚§ãƒƒã‚¯ã§å¾€å¾©è¨ˆç®—ï¼‰</label>
        </div>
    </div>

    <div id="multiCarForm" style="display:none;">
        <div class="car-list-container">
            <div class="car-input-labels">
                <div>è»Šå</div>
                <div>è·é›¢</div>
                <div>ç‡ƒè²»</div>
                <div>ä¾¡æ ¼</div>
                <div></div> 
            </div>
            <div id="carList"></div>
        </div>
        <button class="sub-btn" id="addCarBtn">+ è»Šã‚’è¿½åŠ </button>

        <label for="multiPeople" style="margin-top:20px;">å‰²ã‚Šå‹˜äººæ•°ï¼ˆä»»æ„ï¼‰</label>
        <input id="multiPeople" type="number" placeholder="ä¾‹ï¼š3">
    </div>

    <button class="main-btn" id="calcBtn">è¨ˆç®—ã™ã‚‹</button>
    <button class="sub-btn" id="resetBtn" style="margin-top:10px;">å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ</button>

    <div id="result" class="result" style="display:none;"></div>

    <div class="copy-row" id="copyRow" style="display:none;">
        <button class="copy-btn primary" id="copyCostBtn">ğŸ“‹ ã‚¬ã‚½ãƒªãƒ³ä»£ã‚³ãƒ”ãƒ¼</button>
        <button class="copy-btn secondary" id="copyPerBtn" style="display:none;">ğŸ“‹ 1äººã‚ãŸã‚Šã‚³ãƒ”ãƒ¼</button>
    </div>

    <div id="historyBox">
        <strong style="font-size:15px;">å±¥æ­´ä¸€è¦§</strong>
        <div id="historyList"></div>
    </div>
</div>

<footer style="text-align:center; margin:24px 0; opacity:0.6;">Â© 2025 Nenpi Calculator</footer>

<script>
const themeBtn = document.getElementById('themeToggle');
themeBtn.addEventListener('click', ()=>{
    document.body.classList.toggle('dark');
});

const tabs = document.querySelectorAll('.tab-btn');
const singleForm = document.getElementById('singleCarForm');
const multiForm = document.getElementById('multiCarForm');
tabs.forEach(tab=>{
    tab.addEventListener('click', ()=>{
        tabs.forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        if(tab.dataset.mode==='single'){
            singleForm.style.display='block';
            multiForm.style.display='none';
        }else{
            singleForm.style.display='none';
            multiForm.style.display='block';
        }
    });
});

const carList = document.getElementById('carList');
const addCarBtn = document.getElementById('addCarBtn');
let carCount=0;
addCarBtn.addEventListener('click', addCarRow);
function addCarRow(name='', distance='', fuel='', price=''){
    carCount++;
    const div = document.createElement('div');
    div.className='car-item';
    div.innerHTML=`
    <strong>
        <span class="car-label">è»Š${carCount}</span>
        <button type="button" onclick="this.closest('.car-item').remove();">å‰Šé™¤</button>
    </strong>
    <div class="car-row-inner">
        <input class="carName" placeholder="ä¾‹ï¼šãƒ—ãƒªã‚¦ã‚¹" value="${name}">
        <input type="number" placeholder="è·é›¢" value="${distance}">
        <input type="number" placeholder="ç‡ƒè²»" value="${fuel}">
        <input type="number" placeholder="ä¾¡æ ¼" value="${price}">
        <div class="car-round-group">
            <input type="checkbox">
            <label>å¾€å¾©</label>
        </div>
    </div>
    `;
    carList.appendChild(div);
}

const resultDiv = document.getElementById('result');
const copyRow = document.getElementById('copyRow');
const copyCostBtn = document.getElementById('copyCostBtn');
const copyPerBtn = document.getElementById('copyPerBtn');
const historyList = document.getElementById('historyList');

function formatYen(num){ return Math.round(num).toLocaleString()+' å††'; }

function calc(){
    let total=0;
    let people=1;
    if(document.querySelector('.tab-btn.active').dataset.mode==='single'){
        let dist=Number(document.getElementById('distance').value);
        let fuel=Number(document.getElementById('fuelEconomy').value);
        let price=Number(document.getElementById('gasPrice').value);
        let round=document.getElementById('roundTrip').checked;
        if(!dist || !fuel || !price){ alert('å…¨ã¦å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
        if(round) dist*=2;
        total=dist/fuel*price;
        const p=document.getElementById('people').value;
        if(p) people=Number(p);
        const per=total/people;
        resultDiv.style.display='block';
        copyRow.style.display='flex';
        copyPerBtn.style.display=p?'inline-block':'none';
        resultDiv.innerHTML=`<b>ã‚¬ã‚½ãƒªãƒ³ä»£:</b> ${formatYen(total)}<br>${p?'<b>1äººã‚ãŸã‚Š:</b> '+formatYen(per):''}`;
        addHistory({mode:'å˜ä½“', total, per, people});
    }else{
        const items=carList.querySelectorAll('.car-item');
        if(items.length===0){ alert('è»Šã‚’è¿½åŠ ã—ã¦ãã ã•ã„'); return; }
        total=0;
        items.forEach(item=>{
            const dist=Number(item.querySelectorAll('input')[1].value);
            const fuel=Number(item.querySelectorAll('input')[2].value);
            const price=Number(item.querySelectorAll('input')[3].value);
            const round=item.querySelectorAll('input')[4].checked;
            if(!dist||!fuel||!price){ alert('è»Šã®æƒ…å ±ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
            total+= (round?dist*2:dist)/fuel*price;
        });
        const p=document.getElementById('multiPeople').value;
        if(p) people=Number(p);
        const per=total/people;
        resultDiv.style.display='block';
        copyRow.style.display='flex';
        copyPerBtn.style.display=p?'inline-block':'none';
        resultDiv.innerHTML=`<b>ã‚¬ã‚½ãƒªãƒ³ä»£åˆè¨ˆ:</b> ${formatYen(total)}<br>${p?'<b>1äººã‚ãŸã‚Š:</b> '+formatYen(per):''}`;
        addHistory({mode:'è¤‡æ•°', total, per, people});
    }
}

function addHistory(data){
    const div = document.createElement('div');
    div.className='historyItem';
    div.innerHTML=`<b>${new Date().toLocaleString()} [${data.mode}]</b>ã‚¬ã‚½ãƒªãƒ³ä»£: ${formatYen(data.total)}${data.people?'<br>1äººã‚ãŸã‚Š: '+formatYen(data.per):''}`;
    historyList.prepend(div);
}

document.getElementById('calcBtn').addEventListener('click', calc);
document.getElementById('resetBtn').addEventListener('click', ()=>{
    document.querySelectorAll('input').forEach(input=>input.value='');
    document.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=false);
    resultDiv.style.display='none';
    copyRow.style.display='none';
    carList.innerHTML='';
    carCount=0;
});

copyCostBtn.addEventListener('click', ()=>{
    navigator.clipboard.writeText(resultDiv.innerText).then(()=>{ alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); });
});
copyPerBtn.addEventListener('click', ()=>{
    const perText=resultDiv.innerText.split('\n')[1]||'';
    navigator.clipboard.writeText(perText).then(()=>{ alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); });
});
</script>
</body>
</html>
